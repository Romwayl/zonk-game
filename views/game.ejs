const socket = io();
const roomId = '<%= roomId %>';
let myPlayerId = null;
let isMyTurn = false;

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
if (roomId) {
    socket.emit('joinRoom', roomId);
} else {
    window.location.href = '/';
}

socket.on('connect', () => {
    console.log('Connected to server');
    myPlayerId = socket.id;
});

socket.on('onlineCount', (count) => {
    document.getElementById('onlineCount').textContent = count;
});

socket.on('gameState', (gameState) => {
    console.log('Game state updated:', gameState);
    updateGameState(gameState);
});

socket.on('playerJoined', (player) => {
    console.log('Player joined:', player);
    addMessage('system', `–ò–≥—Ä–æ–∫ ${player.username} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è`);
});

socket.on('playerLeft', (player) => {
    console.log('Player left:', player);
    addMessage('system', `–ò–≥—Ä–æ–∫ ${player.username} –≤—ã—à–µ–ª`);
});

socket.on('chatMessage', (data) => {
    console.log('Chat message:', data);
    addMessage(data.player, data.message);
});

socket.on('gameMessage', (data) => {
    console.log('Game message:', data);
    if (data.type === 'zonk') {
        addMessage('system', `üí• ${data.player} –ø–æ–ª—É—á–∏–ª ZONK!`);
    } else if (data.type === 'hotDice') {
        addMessage('system', `üéâ ${data.player} –ø–æ–ª—É—á–∏–ª Hot Dice!`);
    } else if (data.type === 'takePoints') {
        addMessage('system', `üí∞ ${data.player} –≤–∑—è–ª ${data.score} –æ—á–∫–æ–≤`);
    } else if (data.type === 'win') {
        addMessage('system', `üèÜ ${data.player} –ø–æ–±–µ–∂–¥–∞–µ—Ç —Å ${data.score} –æ—á–∫–∞–º–∏!`);
    }
});

socket.on('error', (message) => {
    console.error('Socket error:', message);
    alert('–û—à–∏–±–∫–∞: ' + message);
});
